<!DOCTYPE html>
<html>

<head>
  <title>Page not found</title>
  <script type="text/javascript">
    window.isErrorPage = true;
    window.errorCode = '404';
  </script>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:title" content="Page not found">
  <script src="/scripts/aem.js" type="module"></script>
  <script src="/scripts/scripts.js" type="module"></script>
  <link rel="stylesheet" href="/styles/styles.css"/>
  
  <!-- Static favicon links - updated by script below -->
  <link rel="apple-touch-icon" href="/styles/apple-touch-icon.png" sizes="180x180" id="apple-icon">
  <link rel="icon" href="/styles/favicon-32x32.png" type="image/png" sizes="32x32" id="favicon-32">
  <link rel="icon" href="/styles/favicon-16x16.png" type="image/png" sizes="16x16" id="favicon-16">
  
  <script>
    // Update favicon hrefs based on domain - wait for DOM
    (function() {
      const hostname = window.location.hostname.toLowerCase();
      const pathname = window.location.pathname.toLowerCase();
      
      let siteType = 'fondations'; // default
      
      console.log('üîç 404 Favicon Debug:', { hostname, pathname });
      
      // Handle localhost development
      if (hostname.includes('localhost')) {
        siteType = 'fondations';
      } else if (hostname.includes('biencommun') || pathname.includes('--biencommun-')) {
        siteType = 'biencommun';
      } else if (hostname.includes('arbres') || pathname.includes('--arbres-')) {
        siteType = 'arbres';
      } else if (hostname.includes('fondations') || pathname.includes('--fondations')) {
        siteType = 'fondations';
      }
      
      console.log('üéØ 404 Favicon: Detected site type:', siteType);
      
      // Function to update favicons
      function updateFavicons() {
        const appleIcon = document.getElementById('apple-icon');
        const favicon32 = document.getElementById('favicon-32');
        const favicon16 = document.getElementById('favicon-16');
        
        console.log('üîó 404 Favicon: Elements found:', { 
          appleIcon: !!appleIcon, 
          favicon32: !!favicon32, 
          favicon16: !!favicon16 
        });
        
        if (!appleIcon || !favicon32 || !favicon16) {
          console.warn('‚ùå 404 Favicon: Could not find favicon elements');
          return;
        }
        
        // Update favicon hrefs if not fondations (since that's the default)
        if (siteType !== 'fondations') {
          console.log('üîÑ 404 Favicon: Updating to', siteType);
          
          if (siteType === 'biencommun') {
            appleIcon.href = '/styles/biencommun-apple-touch-icon.png';
            favicon32.href = '/styles/biencommun-favicon-32x32.png';
            favicon16.href = '/styles/biencommun-favicon-16x16.png';
          } else if (siteType === 'arbres') {
            appleIcon.href = '/styles/arbres-apple-touch-icon.png';
            favicon32.href = '/styles/arbres-favicon-32x32.png';
            favicon16.href = '/styles/arbres-favicon-16x16.png';
          }
          
          console.log('‚úÖ 404 Favicon: Updated hrefs to:', {
            apple: appleIcon.href,
            favicon32: favicon32.href,
            favicon16: favicon16.href
          });
        } else {
          console.log('‚ÑπÔ∏è 404 Favicon: Using default fondations favicons');
        }
      }
      
      // Try to update immediately, or wait for DOM
      if (document.getElementById('apple-icon')) {
        updateFavicons();
      } else {
        document.addEventListener('DOMContentLoaded', updateFavicons);
        // Fallback with timeout
        setTimeout(updateFavicons, 100);
      }
    })();
  </script>

  <script type="module">
    import { sampleRUM } from '/scripts/aem.js';
    sampleRUM('404', { source: document.referrer });
  </script>

  <style>
    main.error {
      padding: 2rem 0;
    }

    .error-page-content {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    .error-page-content h2 {
      margin-bottom: 1rem;
    }

    .error-message-container {
      margin-top: 40px;
    }

    @media (min-width: 900px) {
      main.error {
        min-height: 200px;
      }

      .error-message-container {
        float: right;
        width: calc((((100% - (12 * 30px)) / 12) * 9) + (8 * 30px));
      }
    }
  </style>
</head>

<body>
  <header></header>
  <main class="error float-right">
    <div class="section">
      <div class="error-page-content">
        <h2>PAGE 404</h2>
        <div class="error-message-container">
          <p data-placeholder="page404Text">Page not found</p>
        </div>
      </div>
    </div>
  </main>
  <footer></footer>
  
  <script>
    // Simple site class application - runs immediately without module loading
    (function() {
      const hostname = window.location.hostname.toLowerCase();
      const pathname = window.location.pathname.toLowerCase();
      
      let siteClass = 'fondations'; // default
      
      // Detect site type (same logic as favicon)
      if (hostname.includes('localhost')) {
        siteClass = 'fondations';
      } else if (hostname.includes('biencommun') || pathname.includes('--biencommun-')) {
        siteClass = 'biencommun';
      } else if (hostname.includes('arbres') || pathname.includes('--arbres-')) {
        siteClass = 'arbres';
      } else if (hostname.includes('fondations') || pathname.includes('--fondations')) {
        siteClass = 'fondations';
      }
      
      // Apply site class to body when DOM is ready
      if (document.body) {
        document.body.classList.add(siteClass);
        console.log('404 Site Class:', siteClass);
      } else {
        document.addEventListener('DOMContentLoaded', function() {
          document.body.classList.add(siteClass);
          console.log('404 Site Class:', siteClass);
        });
      }
    })();
  </script>
  
  <script type="module">
    // Only load 404 text functionality
    import { load404 } from '/scripts/scripts.js';
    load404();
  </script>
</body>

</html>
